containers:
  diary-client:
    image: node:14.6.0
    working_directory: /app
    command: yarn workspace client dev
    health_check:
      command: curl localhost:3000
      retries: 20
      interval: 6s
    volumes:
      - local: .
        container: /app
      - type: cache
        name: node-modules
        container: /app/node_modules
      - type: cache
        name: client-node-modules
        container: /app/client/node_modules
      - type: cache
        name: server-node-modules
        container: /app/server/node_modules
      - type: cache
        name: e2e-node-modules
        container: /app/e2e/node_modules

tasks:
  client-lint:
    prerequisites:
      - setup
    run:
      container: diary-static
      command: yarn workspace client lint
  client-test:
    prerequisites:
      - setup
    run:
      container: diary-static
      command: yarn workspace client test
  client-coverage:
    prerequisites:
      - setup
    run:
      container: diary-static
      command: yarn workspace client coverage
